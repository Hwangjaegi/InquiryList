<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="/image/didimIcon.png" rel="icon" type="image/png">
    <title>í”„ë¡œì íŠ¸ ëª©ë¡</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: "Noto Sans KR", sans-serif; background: linear-gradient(135deg, #f0fdfa 0%, #ecfdf5 25%, #f0fdf4 50%, #f7fee7 75%, #fffbeb 100%); min-height: 100vh; color: #333; }
        .container { display: flex; min-height: 100vh; }
        .sidebar { width: 250px; background: rgba(255,255,255,0.85); backdrop-filter: blur(10px); border-right: 1px solid rgba(168,230,207,0.3); padding: 20px; transition: all 0.3s ease; }
        .sidebar h2 { color: #4a9b8e; margin-bottom: 30px; text-align: center; font-size: 1.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .menu-item { display: block; padding: 15px 20px; margin-bottom: 10px; background: rgba(168,230,207,0.2); border: 1px solid rgba(168,230,207,0.3); border-radius: 10px; color: #4a9b8e; text-decoration: none; transition: all 0.3s ease; cursor: pointer; position: relative; overflow: hidden; font-weight: 500; }
        .menu-item:hover { background: rgba(168,230,207,0.4); transform: translateX(5px); color: #2d6a5d; }
        .menu-item.active { background: linear-gradient(135deg, #a8e6cf, #7fcdcd); color: white; box-shadow: 0 4px 15px rgba(168,230,207,0.3); }
        .menu-item-logout { background: linear-gradient(45deg, #ff6b6b, #ee5a52); border: 1px solid rgba(255,107,107,0.3); color: white; }
        .menu-item-logout:hover { background: linear-gradient(45deg, #ff8787, #f76c6c); transform: translateX(5px); color: white; box-shadow: 0 4px 15px rgba(255,107,107,0.4); }
        .menu-item-logout::before { background: linear-gradient(90deg, transparent, rgba(255,107,107,0.3), transparent); }
        .menu-item-logout:hover::before { left: 100%; }
        .nav-section { margin-bottom: 20px; }
        .nav-section-title { color: #4a9b8e; font-size: 1rem; font-weight: 600; margin-bottom: 10px; padding-left: 10px; }
        .main-content { flex: 1; padding: 30px; background: rgba(255,255,255,0.3); backdrop-filter: blur(5px); }
        .header { background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; margin-bottom: 30px; border: 1px solid rgba(168,230,207,0.3); }
        .header h1 { color: #4a9b8e; font-size: 2rem; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header p { color: #666; font-size: 1.1rem; }
        .content-card { background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); border-radius: 15px; padding: 30px; border: 1px solid rgba(168,230,207,0.3); box-shadow: 0 8px 32px rgba(168,230,207,0.15); }
        .form-section { margin-bottom: 30px; }
        .form-section h3 { color: #4a9b8e; margin-bottom: 20px; font-size: 1.3rem; }
        .form-group { display: flex; gap: 15px; margin-bottom: 20px; align-items: center; }
        .form-group input, .form-group select { flex: 1; padding: 12px 15px; border: 1px solid rgba(168,230,207,0.5); border-radius: 8px; background: rgba(255,255,255,0.9); color: #333; font-size: 1rem; transition: all 0.3s ease; font-family: inherit; }
        .form-group input::placeholder { color: #999; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #a8e6cf; background: rgba(255,255,255,1); box-shadow: 0 0 0 3px rgba(168,230,207,0.2); }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; position: relative; overflow: hidden; text-decoration: none; display: inline-block; text-align: center; }
        .btn-primary { background: linear-gradient(45deg, #a8e6cf, #7fcdcd); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(168,230,207,0.4); }
        .btn-danger { background: linear-gradient(45deg, #ff6b6b, #ee5a52); color: white; }
        .btn-danger:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(255,107,107,0.4); }
        .btn-edit { background: linear-gradient(45deg, #4fc3f7, #29b6f6); color: white; padding: 8px 16px; font-size: 0.9rem; }
        .btn-edit:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(79,195,247,0.4); }
        .btn-delete { background: linear-gradient(45deg, #ff7043, #f4511e); color: white; padding: 8px 16px; font-size: 0.9rem; }
        .btn-delete:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255,112,67,0.4); }
        .btn-secondary { background: linear-gradient(45deg, #9e9e9e, #757575); color: white; }
        .btn-secondary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(158,158,158,0.4); }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; text-align: center; border: 1px solid rgba(168,230,207,0.3); transition: transform 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(168,230,207,0.2); }
        .stat-number { font-size: 2rem; font-weight: bold; color: #4a9b8e; margin-bottom: 10px; }
        .stat-label { color: #666; font-size: 0.9rem; }
        .project-list { margin-top: 30px; }
        .project-table { width: 100%; border-collapse: collapse; background: rgba(255,255,255,0.9); border-radius: 12px; overflow: hidden; border: 1px solid rgba(168,230,207,0.3); box-shadow: 0 8px 25px rgba(168,230,207,0.2); }
        .project-table th, .project-table td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(168,230,207,0.3); }
        .project-table th { background: linear-gradient(135deg, #a8e6cf, #7fcdcd); color: white; font-weight: 600; font-size: 1rem; }
        .project-table tr { transition: all 0.3s ease; }
        .project-table tr:hover { background: rgba(168,230,207,0.1); transform: translateY(-2px); }
        .project-table .project-actions { display: flex; gap: 8px; justify-content: flex-end; }
        .search-container { position: relative; margin-bottom: 20px; }
        .search-input { width: 100%; padding: 15px 20px; padding-left: 50px; border: 1px solid rgba(168,230,207,0.5); border-radius: 25px; background: rgba(255,255,255,0.9); color: #333; font-size: 1rem; transition: all 0.3s ease; }
        .search-input::placeholder { color: #999; }
        .search-input:focus { outline: none; border-color: #a8e6cf; background: rgba(255,255,255,1); box-shadow: 0 0 0 3px rgba(168,230,207,0.2); }
        .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: #a8e6cf; font-size: 1.2rem; cursor: pointer; }
        .pagination { display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 30px; }
        .pagination-button { padding: 10px 16px; border: 1px solid rgba(168,230,207,0.5); border-radius: 8px; background: rgba(255,255,255,0.9); color: #4a9b8e; text-decoration: none; transition: all 0.3s ease; font-size: 0.9rem; font-weight: 600; min-width: 44px; text-align: center; }
        .pagination-button:hover:not(.disabled) { background: rgba(168,230,207,0.4); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(168,230,207,0.2); }
        .pagination-button.active { background: linear-gradient(45deg, #a8e6cf, #7fcdcd); color: white; border: none; box-shadow: 0 4px 15px rgba(168,230,207,0.3); }
        .pagination-button.disabled { color: #999; pointer-events: none; background: rgba(255,255,255,0.5); opacity: 0.5; }
        .pagination-nav { display: flex; align-items: center; gap: 4px; font-size: 0.85rem; }
        .message-alert {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            animation: slideInRight 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
        }
        .message-success {
            background: linear-gradient(135deg, #4caf50, #388e3c);
            color: white;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        .message-error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        .message-icon {
            font-size: 1.1rem;
        }
        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            max-width: 600px;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            margin: 0;
            color: #4a9b8e;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #999;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(168, 230, 207, 0.2);
            color: #4a9b8e;
        }

        .modal-body {
            padding: 10px 0;
        }

        .form-row {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #a8e6cf;
            box-shadow: 0 0 0 3px rgba(168,230,207,0.2);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 15px;
            margin-top: 20px;
            border-top: 1px solid #eee;
        }
        .modal.show {
            display: block;
        }
    </style>
</head>
<body>
<div class="container">
    <aside class="sidebar">
        <h2>ê´€ë¦¬ìí˜ì´ì§€</h2>
        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">ê´€ë¦¬ ë©”ë‰´</div>
                <a class="menu-item" th:href="@{/admin/myInfo}">ğŸ™â€â™‚ï¸ ë‚´ì •ë³´</a>
                <a class="menu-item" th:href="@{/admin/console}">ğŸ‘¥ ê³ ê° ì½”ë“œ ê´€ë¦¬</a>
                <a class="menu-item" th:href="@{/admin/customerList}">ğŸ‘¤ ì‚¬ìš©ì ê´€ë¦¬</a>
                <a class="menu-item active" th:href="@{/admin/projectListAdmin}">ğŸ“‹ í”„ë¡œì íŠ¸ ëª©ë¡</a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">ê¸°íƒ€</div>
                <a class="menu-item" th:href="@{/inquiryList}">ğŸ“‹ ë¬¸ì˜ë¦¬ìŠ¤íŠ¸</a>
                <a class="menu-item menu-item-logout" th:href="@{/logout}">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </nav>
    </aside>
    <main class="main-content">
        <div class="header">
            <h1>í”„ë¡œì íŠ¸ ëª©ë¡</h1>
            <p>ì „ì²´ í”„ë¡œì íŠ¸ë¥¼ í™•ì¸í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
        <div class="content-card">
            <div class="form-section">
                <h3>í”„ë¡œì íŠ¸ ì¶”ê°€</h3>
                <form id="addProjectForm" method="post" th:action="@{/admin/projectAdd}">
                    <div class="form-group" style="align-items: center;">
                        <label class="form-label" for="projectSubject">í”„ë¡œì íŠ¸ëª…</label>
                        <input class="form-input" id="projectSubject" name="projectSubject" placeholder="í”„ë¡œì íŠ¸ ì œëª©" required type="text">
                        <label class="form-label" for="customerCode">ê³ ê°ì½”ë“œ</label>
                        <select class="form-input" id="customerCode" name="customerId" required>
                            <option disabled selected value="">ê³ ê°ì½”ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            <option th:each="customer : ${customerList}" th:text="${customer.code}" th:value="${customer.id}"></option>
                        </select>
                        <button class="btn btn-primary" style="margin-left: 10px;" type="submit">ì¶”ê°€</button>
                    </div>
                    <div class="message-alert message-success" th:if="${successMessage}">
                        <span class="message-icon">âœ…</span>
                        <span th:text="${successMessage}"></span>
                    </div>
                    <div class="message-alert message-error" th:if="${errorMessage}">
                        <span class="message-icon">âŒ</span>
                        <span th:text="${errorMessage}"></span>
                    </div>
                </form>
            </div>
            <div class="project-list">
                <table class="project-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>í”„ë¡œì íŠ¸ëª…</th>
                            <th>ê³ ê°ì½”ë“œ</th>
                            <th>ë“±ë¡ì¼</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="project : ${projectList}">
                            <td th:text="${project.id}">1</td>
                            <td th:text="${project.subject}">í”„ë¡œì íŠ¸ ì œëª©</td>
                            <td th:text="${project.customer != null ? project.customer.code : ''}">CUST001</td>
                            <td th:text="${#temporals.format(project.createdAt, 'yyyy-MM-dd HH:mm')}">2024-07-01 12:00</td>
                            <td class="project-actions">
                                <button class="btn btn-edit" th:attr="data-id=${project.id}" type="button">ìˆ˜ì •</button>
                                <button class="btn btn-delete" th:attr="data-id=${project.id}" type="button">ì‚­ì œ</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <!-- í˜ì´ì§• -->
                <div class="pagination" th:if="${totalPages > 1}">
                    <th:block th:with="
                        pageGroupSize=5,
                        currentGroupIndex=${currentPage / pageGroupSize},
                        startPage=${currentGroupIndex * pageGroupSize},
                        endPage=${(startPage + pageGroupSize - 1) < (totalPages - 1) ? (startPage + pageGroupSize - 1) : (totalPages - 1)},
                        hasPrevGroup=${currentGroupIndex > 0},
                        hasNextGroup=${endPage < (totalPages - 1)},
                        prevGroupStartPage=${(currentGroupIndex - 1) * pageGroupSize},
                        nextGroupStartPage=${(currentGroupIndex + 1) * pageGroupSize}">
                        <a class="pagination-button"
                           th:classappend="${currentPage == 0} ? 'disabled'"
                           th:href="@{/admin/projectListAdmin(page=0, size=${pageSize}, search=${searchKeyword})}">
                            <span class="pagination-nav"><<</span>
                        </a>
                        <a class="pagination-button"
                           th:classappend="${!hasPrevGroup} ? 'disabled'"
                           th:href="@{/admin/projectListAdmin(page=${prevGroupStartPage}, size=${pageSize}, search=${searchKeyword})}">
                            <span class="pagination-nav">ì´ì „</span>
                        </a>
                        <a class="pagination-button"
                           th:classappend="${page == currentPage} ? 'active'"
                           th:each="page : ${#numbers.sequence(startPage, endPage)}"
                           th:href="@{/admin/projectListAdmin(page=${page}, size=${pageSize}, search=${searchKeyword})}"
                           th:text="${page + 1}">1</a>
                        <a class="pagination-button"
                           th:classappend="${!hasNextGroup} ? 'disabled'"
                           th:href="@{/admin/projectListAdmin(page=${nextGroupStartPage}, size=${pageSize}, search=${searchKeyword})}">
                            <span class="pagination-nav">ë‹¤ìŒ</span>
                        </a>
                        <a class="pagination-button"
                           th:classappend="${currentPage == (totalPages - 1)} ? 'disabled'"
                           th:href="@{/admin/projectListAdmin(page=${totalPages - 1}, size=${pageSize}, search=${searchKeyword})}">
                            <span class="pagination-nav">>></span>
                        </a>
                    </th:block>
                </div>
            </div>
        </div>
    </main>
</div>
<!-- í”„ë¡œì íŠ¸ ìˆ˜ì • ëª¨ë‹¬  -->
<div class="modal" id="editProjectModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">í”„ë¡œì íŠ¸ ìˆ˜ì •</h3>
            <button class="modal-close" onclick="closeEditProjectModal()">Ã—</button>
        </div>
        <form id="editProjectForm" method="post" th:action="@{/admin/updateProject}">
            <div class="modal-body">
                <div class="form-row">
                    <input id="editProjectId" name="projectId" type="hidden">
                    <label class="form-label">í”„ë¡œì íŠ¸ëª…</label>
                    <input class="form-input" id="editProjectSubject" name="projectSubject" required type="text">
                </div>
                <div class="form-row">
                    <label class="form-label">ê³ ê°ì½”ë“œ</label>
                    <select class="form-input" id="editCustomerCode" name="customerId" required>
                        <option disabled value="">ê³ ê°ì½”ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        <option th:each="customer : ${customerList}" th:text="${customer.code}" th:value="${customer.id}"></option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditProjectModal()" type="button">ì·¨ì†Œ</button>
                <button class="btn btn-primary" type="submit">ì €ì¥</button>
            </div>
        </form>
    </div>
</div>
<!-- í”„ë¡œì íŠ¸ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
<div class="modal" id="deleteProjectModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">í”„ë¡œì íŠ¸ ì‚­ì œ</h3>
            <button class="modal-close" onclick="closeDeleteProjectModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <p>ì •ë§ë¡œ <strong id="deleteProjectName"></strong> (ê³ ê°ì½”ë“œ: <span id="deleteProjectCustomerCode"></span>) í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <p style="color: #f44336; font-size: 0.9rem; margin-top: 10px;">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeDeleteProjectModal()" type="button">ì·¨ì†Œ</button>
            <button class="btn btn-danger" onclick="confirmDeleteProject()" type="button">ì‚­ì œ</button>
        </div>
    </div>
</div>
<script>
    // ë©”ì‹œì§€ ì•Œë¦¼ ìë™ ì‚¬ë¼ì§ (message-alertë§Œ ì‚¬ë¼ì§€ê²Œ)
    setTimeout(() => {
        document.querySelectorAll('.message-alert').forEach(alert => {
            alert.style.opacity = '0';
            alert.style.transform = 'translateX(20px)';
            setTimeout(() => {
                alert.remove();
            }, 300);
        });
    }, 4000);

    // í”„ë¡œì íŠ¸ ìˆ˜ì • ëª¨ë‹¬ í•¸ë“¤ëŸ¬
    let currentEditProjectId = null;

    // ìˆ˜ì • ë²„íŠ¼ì— ì´ë²¤íŠ¸ ìœ„ì„
    // (ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ê²½ìš°ì—ë„ ë™ì‘)
    document.addEventListener('click', function(e) {
        if (e.target && e.target.classList.contains('btn-edit')) {
            const tr = e.target.closest('tr');
            const id = e.target.getAttribute('data-id');
            const subject = tr.querySelector('td:nth-child(2)').textContent.trim();
            const customerCode = tr.querySelector('td:nth-child(3)').textContent.trim();
            openEditProjectModal(id, subject, customerCode);
        }
    });

    function openEditProjectModal(id, subject, customerCode) {
        currentEditProjectId = id;
        document.getElementById('editProjectId').value = id;
        document.getElementById('editProjectSubject').value = subject;
        // ê³ ê°ì½”ë“œ selectì—ì„œ í•´ë‹¹ ê°’ ì„ íƒ
        const select = document.getElementById('editCustomerCode');
        for (let i = 0; i < select.options.length; i++) {
            if (select.options[i].text === customerCode) {
                select.selectedIndex = i;
                break;
            }
        }
        document.getElementById('editProjectModal').classList.add('show');
    }

    function closeEditProjectModal() {
        document.getElementById('editProjectModal').classList.remove('show');
        currentEditProjectId = null;
    }

    // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ìœ„ì„
    let currentDeleteProjectId = null;
    document.addEventListener('click', function(e) {
        if (e.target && e.target.classList.contains('btn-delete')) {
            const tr = e.target.closest('tr');
            const id = e.target.getAttribute('data-id');
            const subject = tr.querySelector('td:nth-child(2)').textContent.trim();
            const customerCode = tr.querySelector('td:nth-child(3)').textContent.trim();
            openDeleteProjectModal(id, subject, customerCode);
        }
    });

    function openDeleteProjectModal(id, subject, customerCode) {
        currentDeleteProjectId = id;
        document.getElementById('deleteProjectName').textContent = subject;
        document.getElementById('deleteProjectCustomerCode').textContent = customerCode;
        document.getElementById('deleteProjectModal').classList.add('show');
    }

    function closeDeleteProjectModal() {
        document.getElementById('deleteProjectModal').classList.remove('show');
        currentDeleteProjectId = null;
    }

    function confirmDeleteProject() {
        if (!currentDeleteProjectId) return;
        // í¼ ìƒì„± í›„ POST ì „ì†¡
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/deleteProject/${currentDeleteProjectId}`;
        document.body.appendChild(form);
        form.submit();
    }
</script>
</body>
</html> 